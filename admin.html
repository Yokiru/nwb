<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - NWB.CREATIVE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <img id="login-logo" src="" alt="Logo"
                    style="width: 60px; height: 60px; border-radius: 12px; object-fit: contain; display: none; margin: 0 auto;">
                <span id="login-logo-fallback" class="logo-icon">‚ú¶</span>
                <h1>NWB.CREATIVE</h1>
                <p>Admin Dashboard</p>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter admin password">
                </div>
                <button type="button" id="login-btn" class="btn btn-primary btn-full">Login</button>
                <p id="login-error" class="login-error"></p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="admin-dashboard" style="display: none;">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <img id="sidebar-logo" src="" alt="Logo"
                    style="width: 28px; height: 28px; border-radius: 6px; object-fit: contain; display: none;">
                <span id="sidebar-logo-fallback" class="logo-icon">‚ú¶</span>
                <span class="logo-text">NWB.CREATIVE</span>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <rect x="3" y="3" width="7" height="7" rx="1" />
                        <rect x="14" y="3" width="7" height="7" rx="1" />
                        <rect x="3" y="14" width="7" height="7" rx="1" />
                        <rect x="14" y="14" width="7" height="7" rx="1" />
                    </svg>
                    Dashboard
                </a>
                <a href="#" class="nav-item" data-page="orders">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2" />
                        <rect x="9" y="3" width="6" height="4" rx="1" />
                        <path d="M9 12h6M9 16h6" />
                    </svg>
                    Orders
                </a>
                <a href="#" class="nav-item" data-page="customize">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                    Customize
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="index.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                    Exit
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="admin-page active">
                <div class="page-header">
                    <div>
                        <h1>Dashboard</h1>
                        <p>Overview of your orders</p>
                    </div>
                    <div class="date-filter">
                        <input type="date" id="date-from" class="date-input">
                        <span style="color: #666;">‚Äî</span>
                        <input type="date" id="date-to" class="date-input">
                        <button class="filter-btn" onclick="applyDateFilter()">Filter</button>
                        <button class="reset-btn" onclick="resetDateFilter()">Reset</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon total">üìä</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-total">0</span>
                            <span class="stat-label">Total Orders</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pending">‚è≥</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-pending">0</span>
                            <span class="stat-label">Pending</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon progress">üé®</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-progress">0</span>
                            <span class="stat-label">In Progress</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon completed">‚úÖ</div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-completed">0</span>
                            <span class="stat-label">Completed</span>
                        </div>
                    </div>
                </div>

                <!-- Commission Card -->
                <div class="commission-card">
                    <div class="commission-header">
                        <span class="commission-label">üí∞ Komisi 10% (Order Selesai)</span>
                        <span class="commission-period" id="commission-period">Semua waktu</span>
                    </div>
                    <div class="commission-amount" id="commission-amount">Rp 0</div>
                    <div class="commission-detail">
                        <span>Total Revenue: <strong id="total-revenue">Rp 0</strong></span>
                        <span>Orders: <strong id="completed-orders-count">0</strong></span>
                    </div>
                </div>

                <div class="recent-orders">
                    <h2>Recent Orders</h2>
                    <div id="recent-orders-list" class="orders-list">
                        <p class="loading">Loading orders...</p>
                    </div>
                </div>
            </div>

            <!-- Orders Page -->
            <div id="page-orders" class="admin-page">
                <div class="page-header">
                    <h1>All Orders</h1>
                    <div class="page-actions">
                        <select id="filter-status" class="filter-select">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in_progress">In Progress</option>
                            <option value="revision">Revision</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>

                <div id="orders-table" class="orders-table">
                    <p class="loading">Loading orders...</p>
                </div>
            </div>

            <!-- Customize Page -->
            <div id="page-customize" class="admin-page">
                <div class="page-header">
                    <h1>Customize Website</h1>
                    <p>Kelola logo dan portfolio images</p>
                </div>

                <!-- Logo Section -->
                <div class="customize-section">
                    <h2 class="section-title">üé® Logo Website</h2>
                    <div class="customize-card">
                        <div class="logo-preview" id="logo-preview">
                            <span class="logo-icon">‚ú¶</span>
                            <span>NWB.CREATIVE</span>
                        </div>

                        <div class="upload-tabs">
                            <button class="tab-btn active" onclick="switchTab('logo', 'upload')">Upload File</button>
                            <button class="tab-btn" onclick="switchTab('logo', 'url')">URL</button>
                        </div>

                        <div id="logo-upload-tab" class="tab-content active">
                            <div class="upload-area">
                                <input type="file" id="logo-file-input" accept="image/*" class="file-input"
                                    onchange="uploadLogo()">
                                <label for="logo-file-input" class="file-label">
                                    <span>üìÅ Pilih gambar logo</span>
                                </label>
                            </div>
                            <div id="logo-upload-status" class="upload-status"></div>
                        </div>

                        <div id="logo-url-tab" class="tab-content">
                            <div class="upload-area">
                                <input type="url" id="logo-url-input" class="input-field"
                                    placeholder="https://example.com/logo.png">
                                <button class="btn-save" onclick="saveLogo()">Simpan</button>
                            </div>
                        </div>

                        <p class="help-text">Format: PNG, JPG, WebP. Disarankan PNG dengan background transparan.</p>
                    </div>
                </div>

                <!-- Portfolio Section -->
                <div class="customize-section">
                    <h2 class="section-title">üñºÔ∏è Portfolio / Work Images</h2>
                    <div class="customize-card">
                        <div class="upload-tabs">
                            <button class="tab-btn active" onclick="switchTab('portfolio', 'upload')">Upload
                                File</button>
                            <button class="tab-btn" onclick="switchTab('portfolio', 'url')">URL</button>
                        </div>

                        <div id="portfolio-upload-tab" class="tab-content active">
                            <div class="upload-area">
                                <input type="file" id="portfolio-file-input" accept="image/*" multiple
                                    class="file-input" onchange="uploadPortfolio()">
                                <label for="portfolio-file-input" class="file-label">
                                    <span>üìÅ Pilih gambar (bisa pilih banyak)</span>
                                </label>
                            </div>
                            <div id="portfolio-upload-status" class="upload-status"></div>
                        </div>

                        <div id="portfolio-url-tab" class="tab-content">
                            <div class="add-portfolio">
                                <input type="url" id="portfolio-url-input" class="input-field"
                                    placeholder="https://example.com/poster.jpg">
                                <button class="btn-add" onclick="addPortfolio()">+ Tambah</button>
                            </div>
                        </div>

                        <div id="portfolio-grid" class="portfolio-grid">
                            <p class="empty-text">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="admin-toast" class="admin-toast"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Mengupload...</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        (function () {
            'use strict';

            // Config
            var SUPABASE_URL = 'https://agefrdpkkrmddzjlyszn.supabase.co';
            var SUPABASE_KEY = 'sb_publishable_rRVtXYoMFaxI3A_jFE_6yg_SYgbonpP';
            var ADMIN_PASSWORD = '12345';
            var supabaseClient = null;

            // Initialize
            function init() {
                if (window.supabase) {
                    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    loadLoginLogo();
                }

                // Check session
                if (sessionStorage.getItem('nwb_admin') === 'true') {
                    showDashboard();
                }

                // Login button
                document.getElementById('login-btn').onclick = function () {
                    var pwd = document.getElementById('password').value;
                    if (pwd === ADMIN_PASSWORD) {
                        sessionStorage.setItem('nwb_admin', 'true');
                        showDashboard();
                    } else {
                        document.getElementById('login-error').textContent = 'Password salah!';
                    }
                };

                // Enter key on password
                document.getElementById('password').onkeypress = function (e) {
                    if (e.key === 'Enter') {
                        document.getElementById('login-btn').click();
                    }
                };


                // Nav click
                document.querySelectorAll('.nav-item[data-page]').forEach(function (item) {
                    item.onclick = function (e) {
                        e.preventDefault();
                        var page = this.getAttribute('data-page');
                        document.querySelectorAll('.nav-item').forEach(function (n) { n.classList.remove('active'); });
                        this.classList.add('active');
                        document.querySelectorAll('.admin-page').forEach(function (p) { p.classList.remove('active'); });
                        document.getElementById('page-' + page).classList.add('active');

                        // Load customize data when switching to that page
                        if (page === 'customize') {
                            loadCustomize();
                        }
                    };
                });

                // Filter
                document.getElementById('filter-status').onchange = function () {
                    loadOrders(this.value);
                };
            }

            function showDashboard() {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'flex';
                loadStats();
                loadOrders();
            }

            function loadStats(dateFrom, dateTo) {
                if (!supabaseClient) return;

                supabaseClient.from('orders').select('status, price, created_at').then(function (res) {
                    var data = res.data || [];

                    // Filter by date if provided
                    if (dateFrom || dateTo) {
                        data = data.filter(function (o) {
                            var orderDate = new Date(o.created_at);
                            if (dateFrom && orderDate < new Date(dateFrom)) return false;
                            if (dateTo && orderDate > new Date(dateTo + 'T23:59:59')) return false;
                            return true;
                        });
                    }

                    // Basic stats
                    document.getElementById('stat-total').textContent = data.length;
                    document.getElementById('stat-pending').textContent = data.filter(function (o) { return o.status === 'pending'; }).length;
                    document.getElementById('stat-progress').textContent = data.filter(function (o) { return o.status === 'in_progress'; }).length;
                    document.getElementById('stat-completed').textContent = data.filter(function (o) { return o.status === 'completed'; }).length;

                    // Commission calculation (10% of completed orders with price)
                    var completedWithPrice = data.filter(function (o) {
                        return o.status === 'completed' && o.price;
                    });
                    var totalRevenue = completedWithPrice.reduce(function (sum, o) {
                        return sum + (parseInt(o.price) || 0);
                    }, 0);
                    var commission = Math.round(totalRevenue * 0.1);

                    document.getElementById('commission-amount').textContent = 'Rp ' + commission.toLocaleString('id-ID');
                    document.getElementById('total-revenue').textContent = 'Rp ' + totalRevenue.toLocaleString('id-ID');
                    document.getElementById('completed-orders-count').textContent = completedWithPrice.length;

                    // Update period label
                    var periodLabel = 'Semua waktu';
                    if (dateFrom && dateTo) {
                        periodLabel = formatShortDate(dateFrom) + ' - ' + formatShortDate(dateTo);
                    } else if (dateFrom) {
                        periodLabel = 'Dari ' + formatShortDate(dateFrom);
                    } else if (dateTo) {
                        periodLabel = 'Sampai ' + formatShortDate(dateTo);
                    }
                    document.getElementById('commission-period').textContent = periodLabel;
                });
            }

            function formatShortDate(dateStr) {
                return new Date(dateStr).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
            }

            window.applyDateFilter = function () {
                var dateFrom = document.getElementById('date-from').value;
                var dateTo = document.getElementById('date-to').value;
                loadStats(dateFrom, dateTo);
            };

            window.resetDateFilter = function () {
                document.getElementById('date-from').value = '';
                document.getElementById('date-to').value = '';
                loadStats();
            };


            function loadOrders(filterStatus) {
                if (!supabaseClient) {
                    document.getElementById('recent-orders-list').innerHTML = '<p class="empty">Database tidak tersedia</p>';
                    document.getElementById('orders-table').innerHTML = '<p class="empty">Database tidak tersedia</p>';
                    return;
                }

                supabaseClient.from('orders').select('*').order('created_at', { ascending: false }).then(function (res) {
                    var orders = res.data || [];

                    if (filterStatus) {
                        orders = orders.filter(function (o) { return o.status === filterStatus; });
                    }

                    renderRecentOrders(orders.slice(0, 5));
                    renderOrdersTable(orders);
                });
            }

            function renderRecentOrders(orders) {
                var container = document.getElementById('recent-orders-list');
                if (orders.length === 0) {
                    container.innerHTML = '<p class="empty">Belum ada order</p>';
                    return;
                }

                var html = '';
                orders.forEach(function (order) {
                    html += '<div class="order-card" onclick="window.showOrderDetail(' + order.id + ')">' +
                        '<div class="order-info">' +
                        '<span class="order-number">' + order.order_number + '</span>' +
                        '<span class="order-name">' + order.name + '</span>' +
                        '<span class="order-title">' + order.judul + '</span>' +
                        '</div>' +
                        '<div class="order-meta">' +
                        '<span class="order-status status-' + order.status + '">' + formatStatus(order.status) + '</span>' +
                        '<span class="order-date">' + formatDate(order.created_at) + '</span>' +
                        '</div>' +
                        '</div>';
                });
                container.innerHTML = html;
            }

            function renderOrdersTable(orders) {
                var container = document.getElementById('orders-table');
                if (orders.length === 0) {
                    container.innerHTML = '<p class="empty">Belum ada order</p>';
                    return;
                }

                var html = '<table><thead><tr><th>Order #</th><th>Nama</th><th>Judul</th><th>Status</th><th>Tanggal</th><th>Action</th></tr></thead><tbody>';
                orders.forEach(function (order) {
                    html += '<tr>' +
                        '<td><strong>' + order.order_number + '</strong></td>' +
                        '<td>' + order.name + '</td>' +
                        '<td>' + order.judul + '</td>' +
                        '<td><span class="status-badge status-' + order.status + '">' + formatStatus(order.status) + '</span></td>' +
                        '<td>' + formatDate(order.created_at) + '</td>' +
                        '<td><button class="btn-view" onclick="window.location.href=\'order-detail.html?id=' + order.id + '\'">View</button></td>' +
                        '</tr>';
                });
                html += '</tbody></table>';
                container.innerHTML = html;
            }

            window.updateStatus = function (orderId, status) {
                if (!supabaseClient) return;
                supabaseClient.from('orders').update({ status: status }).eq('id', orderId).then(function () {
                    loadStats();
                    loadOrders();
                });
            };


            function formatStatus(status) {
                var labels = { pending: 'Pending', in_progress: 'In Progress', revision: 'Revision', completed: 'Completed', cancelled: 'Cancelled' };
                return labels[status] || status;
            }

            function formatDate(dateString) {
                return new Date(dateString).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
            }

            function formatDateTime(dateString) {
                return new Date(dateString).toLocaleString('id-ID', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
            }

            // ========== CUSTOMIZATION FUNCTIONS ==========
            function loadCustomize() {
                loadLogoPreview();
                loadPortfolio();
            }

            function loadLogoPreview() {
                if (!supabaseClient) return;
                supabaseClient.from('site_settings').select('value').eq('key', 'logo_url').single().then(function (res) {
                    var logoUrl = res.data && res.data.value;
                    var preview = document.getElementById('logo-preview');
                    if (logoUrl) {
                        preview.innerHTML = '<img src="' + logoUrl + '" alt="Logo">';
                        document.getElementById('logo-url-input').value = logoUrl;
                    }
                });
            }

            window.saveLogo = function () {
                var logoUrl = document.getElementById('logo-url-input').value.trim();
                if (!logoUrl) {
                    alert('Masukkan URL gambar logo');
                    return;
                }

                supabaseClient.from('site_settings').update({ value: logoUrl }).eq('key', 'logo_url').then(function (res) {
                    if (!res.error) {
                        alert('Logo berhasil disimpan!');
                        loadLogoPreview();
                    } else {
                        alert('Gagal menyimpan logo');
                    }
                });
            };

            function loadPortfolio() {
                if (!supabaseClient) return;
                var container = document.getElementById('portfolio-grid');

                supabaseClient.from('portfolio').select('*').order('sort_order', { ascending: true }).then(function (res) {
                    var items = res.data || [];

                    if (items.length === 0) {
                        container.innerHTML = '<p class="empty-text">Belum ada portfolio. Tambahkan gambar pertama!</p>';
                        return;
                    }

                    var html = '';
                    items.forEach(function (item) {
                        html += '<div class="portfolio-item">' +
                            '<img src="' + item.image_url + '" alt="Portfolio">' +
                            '<button class="delete-btn" onclick="deletePortfolio(' + item.id + ')">√ó</button>' +
                            '</div>';
                    });
                    container.innerHTML = html;
                });
            }

            window.addPortfolio = function () {
                var imageUrl = document.getElementById('portfolio-url-input').value.trim();
                if (!imageUrl) {
                    alert('Masukkan URL gambar portfolio');
                    return;
                }

                supabaseClient.from('portfolio').insert({ image_url: imageUrl }).then(function (res) {
                    if (!res.error) {
                        document.getElementById('portfolio-url-input').value = '';
                        loadPortfolio();
                    } else {
                        alert('Gagal menambahkan portfolio');
                    }
                });
            };

            window.deletePortfolio = function (id) {
                if (!confirm('Hapus gambar ini?')) return;

                supabaseClient.from('portfolio').delete().eq('id', id).then(function (res) {
                    if (!res.error) {
                        loadPortfolio();
                    }
                });
            };

            // Tab switching
            window.switchTab = function (section, tab) {
                var uploadTab = document.getElementById(section + '-upload-tab');
                var urlTab = document.getElementById(section + '-url-tab');
                var tabs = uploadTab.parentElement.querySelectorAll('.tab-btn');

                tabs.forEach(function (btn) { btn.classList.remove('active'); });

                if (tab === 'upload') {
                    uploadTab.classList.add('active');
                    urlTab.classList.remove('active');
                    tabs[0].classList.add('active');
                } else {
                    uploadTab.classList.remove('active');
                    urlTab.classList.add('active');
                    tabs[1].classList.add('active');
                }
            };

            // Toast & Loading helpers
            function showToast(message, type) {
                var toast = document.getElementById('admin-toast');
                toast.textContent = message;
                toast.className = 'admin-toast show' + (type ? ' ' + type : '');
                setTimeout(function () { toast.classList.remove('show'); }, 3000);
            }

            function showLoading() {
                document.getElementById('loading-overlay').classList.add('show');
            }

            function hideLoading() {
                document.getElementById('loading-overlay').classList.remove('show');
            }

            // File upload to Supabase Storage
            window.uploadLogo = async function () {
                var fileInput = document.getElementById('logo-file-input');
                var file = fileInput.files[0];
                var statusContainer = document.getElementById('logo-upload-status');

                if (!file) return;

                // Show upload status
                statusContainer.innerHTML = '<div class="upload-item">' +
                    '<div class="spinner"></div>' +
                    '<span class="filename">' + file.name + '</span>' +
                    '<span class="status-text">Mengupload...</span>' +
                    '</div>';

                var fileName = 'logo-' + Date.now() + '.' + file.name.split('.').pop();

                var { data, error } = await supabaseClient.storage
                    .from('images')
                    .upload(fileName, file, { upsert: true });

                if (error) {
                    statusContainer.innerHTML = '<div class="upload-item">' +
                        '<span style="color:#ef4444;">‚úó</span>' +
                        '<span class="filename">' + file.name + '</span>' +
                        '<span class="status-text">Gagal: ' + error.message + '</span>' +
                        '</div>';
                    return;
                }

                var { data: urlData } = supabaseClient.storage.from('images').getPublicUrl(fileName);
                var publicUrl = urlData.publicUrl;

                await supabaseClient.from('site_settings').update({ value: publicUrl }).eq('key', 'logo_url');

                statusContainer.innerHTML = '<div class="upload-item">' +
                    '<span class="check">‚úì</span>' +
                    '<span class="filename">' + file.name + '</span>' +
                    '<span class="status-text">Selesai</span>' +
                    '</div>';

                showToast('Logo berhasil diupload!');
                loadLogoPreview();
                fileInput.value = '';
                setTimeout(function () { statusContainer.innerHTML = ''; }, 2000);
            };

            window.uploadPortfolio = async function () {
                var fileInput = document.getElementById('portfolio-file-input');
                var files = fileInput.files;
                var statusContainer = document.getElementById('portfolio-upload-status');

                if (files.length === 0) return;

                // Show upload items
                var html = '';
                for (var i = 0; i < files.length; i++) {
                    html += '<div class="upload-item" id="upload-item-' + i + '">' +
                        '<div class="spinner"></div>' +
                        '<span class="filename">' + files[i].name + '</span>' +
                        '<span class="status-text">Mengupload...</span>' +
                        '</div>';
                }
                statusContainer.innerHTML = html;

                for (var i = 0; i < files.length; i++) {
                    var file = files[i];
                    var fileName = 'portfolio-' + Date.now() + '-' + i + '.' + file.name.split('.').pop();
                    var itemEl = document.getElementById('upload-item-' + i);

                    var { data, error } = await supabaseClient.storage
                        .from('images')
                        .upload(fileName, file);

                    if (!error) {
                        var { data: urlData } = supabaseClient.storage.from('images').getPublicUrl(fileName);
                        await supabaseClient.from('portfolio').insert({ image_url: urlData.publicUrl });
                        itemEl.innerHTML = '<span class="check">‚úì</span>' +
                            '<span class="filename">' + file.name + '</span>' +
                            '<span class="status-text">Selesai</span>';
                    } else {
                        itemEl.innerHTML = '<span style="color:#ef4444;">‚úó</span>' +
                            '<span class="filename">' + file.name + '</span>' +
                            '<span class="status-text">Gagal</span>';
                    }
                }

                showToast('Upload selesai!');
                loadPortfolio();
                fileInput.value = '';
                setTimeout(function () { statusContainer.innerHTML = ''; }, 2000);
            };

            // Load login logo from database
            async function loadLoginLogo() {
                try {
                    const { data } = await supabaseClient.from('site_settings').select('value').eq('key', 'logo_url').single();
                    if (data && data.value) {
                        // Login page logo
                        const logoImg = document.getElementById('login-logo');
                        const fallback = document.getElementById('login-logo-fallback');
                        if (logoImg) {
                            logoImg.src = data.value;
                            logoImg.style.display = 'block';
                        }
                        if (fallback) fallback.style.display = 'none';

                        // Sidebar logo
                        const sidebarLogo = document.getElementById('sidebar-logo');
                        const sidebarFallback = document.getElementById('sidebar-logo-fallback');
                        if (sidebarLogo) {
                            sidebarLogo.src = data.value;
                            sidebarLogo.style.display = 'block';
                        }
                        if (sidebarFallback) sidebarFallback.style.display = 'none';
                    }
                } catch (e) { }
            }

            // Run on load
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>

</html>